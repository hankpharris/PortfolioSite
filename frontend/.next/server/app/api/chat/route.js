"use strict";(()=>{var e={};e.id=744,e.ids=[744],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},51897:(e,t,s)=>{let n,r,a;s.r(t),s.d(t,{headerHooks:()=>nT,originalPathname:()=>nP,patchFetch:()=>nN,requestAsyncStorage:()=>nO,routeModule:()=>nR,serverHooks:()=>nj,staticGenerationAsyncStorage:()=>nk,staticGenerationBailout:()=>nE});var i,o,l,c,u,h,d,f,p,m,g,y,w,_,b,v,x,S,A,$,I,R,O,k,j,T,E,P,N,C,M,L,D,B,F,W,q,U,J,X,H,K,V,Y,z,G,Q,Z,ee,et,es,en,er,ea,ei,eo,el,ec,eu,eh,ed,ef,ep,em,eg,ey,ew,e_,eb,ev,ex={};s.r(ex),s.d(ex,{GET:()=>nI,POST:()=>n$});var eS=s(6170),eA=s(8533),e$=s(54387);let eI=[239,187,191];var eR={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},eO={code:"1",name:"function_call",parse:e=>{if(null==e||"object"!=typeof e||!("function_call"in e)||"object"!=typeof e.function_call||null==e.function_call||!("name"in e.function_call)||!("arguments"in e.function_call)||"string"!=typeof e.function_call.name||"string"!=typeof e.function_call.arguments)throw Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:e}}},ek={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},ej={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},eT={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},eE={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},eP={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},eN={code:"7",name:"tool_calls",parse:e=>{if(null==e||"object"!=typeof e||!("tool_calls"in e)||"object"!=typeof e.tool_calls||null==e.tool_calls||!Array.isArray(e.tool_calls)||e.tool_calls.some(e=>{null!=e&&"object"==typeof e&&"id"in e&&"string"==typeof e.id&&"type"in e&&"string"==typeof e.type&&"function"in e&&null!=e.function&&"object"==typeof e.function&&"arguments"in e.function&&"string"==typeof e.function.name&&e.function.arguments}))throw Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value:e}}},eC={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},eM=[eR,eO,ek,ej,eT,eE,eP,eN,eC],eL={[eR.code]:eR,[eO.code]:eO,[ek.code]:ek,[ej.code]:ej,[eT.code]:eT,[eE.code]:eE,[eP.code]:eP,[eN.code]:eN,[eC.code]:eC},eD=(eR.name,eR.code,eO.name,eO.code,ek.name,ek.code,ej.name,ej.code,eT.name,eT.code,eE.name,eE.code,eP.name,eP.code,eN.name,eN.code,eC.name,eC.code,eM.map(e=>e.code)),eB=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let s=e.slice(0,t);if(!eD.includes(s))throw Error(`Failed to parse stream string. Invalid code ${s}.`);let n=JSON.parse(e.slice(t+1));return eL[s].parse(n)};function eF(e,t){let s=eM.find(t=>t.name===e);if(!s)throw Error(`Invalid stream part type: ${e}`);return`${s.code}:${JSON.stringify(t)}
`}function eW(e){let t=new TextEncoder,s="",n=e||{};return new TransformStream({async start(){n.onStart&&await n.onStart()},async transform(e,r){r.enqueue(t.encode(e)),s+=e,n.onToken&&await n.onToken(e)},async flush(){n.onCompletion&&await n.onCompletion(s),!n.onFinal||"experimental_onFunctionCall"in n||await n.onFinal(s)}})}((e,t=21)=>(s=t)=>{let n="",r=s;for(;r--;)n+=e[Math.random()*e.length|0];return n})("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7);new TextDecoder("utf-8");async function*eq(e){let t=eU();for await(let s of e){"promptFilterResults"in s&&(s={id:s.id,created:s.created.getDate(),object:s.object,model:s.model,choices:s.choices.map(e=>{var t,s,n,r,a,i,o;return{delta:{content:null==(t=e.delta)?void 0:t.content,function_call:null==(s=e.delta)?void 0:s.functionCall,role:null==(n=e.delta)?void 0:n.role,tool_calls:(null==(a=null==(r=e.delta)?void 0:r.toolCalls)?void 0:a.length)?null==(o=null==(i=e.delta)?void 0:i.toolCalls)?void 0:o.map((e,t)=>({index:t,id:e.id,function:e.function,type:e.type})):void 0},finish_reason:e.finishReason,index:e.index}})});let e=t(s);e&&(yield e)}}function eU(){let e,t;let s=(t=!0,e=>(t&&(e=e.trimStart())&&(t=!1),e));return t=>{var r,a,i,o,l,c,u,h,d,f,p,m,g,y,w,_,b,v;if(eX(t)){let s=null==(r=t.choices[0])?void 0:r.delta;if(null==(a=s.function_call)?void 0:a.name)return e=!0,`{"function_call": {"name": "${s.function_call.name}", "arguments": "`;if(null==(l=null==(o=null==(i=s.tool_calls)?void 0:i[0])?void 0:o.function)?void 0:l.name){e=!0;let t=s.tool_calls[0];return 0===t.index?`{"tool_calls":[ {"id": "${t.id}", "type": "function", "function": {"name": "${null==(c=t.function)?void 0:c.name}", "arguments": "`:`"}}, {"id": "${t.id}", "type": "function", "function": {"name": "${null==(u=t.function)?void 0:u.name}", "arguments": "`}if(null==(h=s.function_call)?void 0:h.arguments)return n(null==(d=s.function_call)?void 0:d.arguments);if(null==(m=null==(p=null==(f=s.tool_calls)?void 0:f[0])?void 0:p.function)?void 0:m.arguments)return n(null==(w=null==(y=null==(g=s.tool_calls)?void 0:g[0])?void 0:y.function)?void 0:w.arguments);else if(e&&((null==(_=t.choices[0])?void 0:_.finish_reason)==="function_call"||(null==(b=t.choices[0])?void 0:b.finish_reason)==="stop"))return e=!1,'"}}';else if(e&&(null==(v=t.choices[0])?void 0:v.finish_reason)==="tool_calls")return e=!1,'"}}]}'}return s(eX(t)&&t.choices[0].delta.content?t.choices[0].delta.content:"choices"in t&&t.choices&&t.choices[0]&&"text"in t.choices[0]?t.choices[0].text:"")};function n(e){let t=e.replace(/\\/g,"\\\\").replace(/\//g,"\\/").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\f/g,"\\f");return`${t}`}}var eJ=Symbol("internal_openai_fn_messages");function eX(e){return"choices"in e&&e.choices&&e.choices[0]&&"delta"in e.choices[0]}var eH=class extends Response{constructor(e,t,s){let n=e;s&&(n=e.pipeThrough(s.stream)),super(n,{...t,status:200,headers:{"Content-Type":"text/plain; charset=utf-8","X-Experimental-Stream-Data":s?"true":"false",...null==t?void 0:t.headers}})}},eK=s(90236);function eV(e,t,s,n,r){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s}function eY(e,t,s,n){if("a"===s&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)}let ez=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return ez=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^s()&15>>+e/4).toString(16))};function eG(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let eQ=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class eZ extends Error{}class e0 extends eZ{constructor(e,t,s,n){super(`${e0.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.requestID=n?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,s){let n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e||!n)return new e2({message:s,cause:eQ(t)});let r=t?.error;return 400===e?new e4(e,r,s,n):401===e?new e8(e,r,s,n):403===e?new e5(e,r,s,n):404===e?new e6(e,r,s,n):409===e?new e9(e,r,s,n):422===e?new e7(e,r,s,n):429===e?new te(e,r,s,n):e>=500?new tt(e,r,s,n):new e0(e,r,s,n)}}class e1 extends e0{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class e2 extends e0{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class e3 extends e2{constructor({message:e}={}){super({message:e??"Request timed out."})}}class e4 extends e0{}class e8 extends e0{}class e5 extends e0{}class e6 extends e0{}class e9 extends e0{}class e7 extends e0{}class te extends e0{}class tt extends e0{}class ts extends eZ{constructor(){super("Could not parse response content as the length limit was reached")}}class tn extends eZ{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}let tr=/^[a-z][a-z0-9+.-]*:/i,ta=e=>tr.test(e);function ti(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let to=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new eZ(`${e} must be an integer`);if(t<0)throw new eZ(`${e} must be a positive integer`);return t},tl=e=>{try{return JSON.parse(e)}catch(e){return}},tc=e=>new Promise(t=>setTimeout(t,e)),tu={off:0,error:200,warn:300,info:400,debug:500},th=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(tu,e))return e;tg(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(tu))}`)}};function td(){}function tf(e,t,s){return!t||tu[e]>tu[s]?td:t[e].bind(t)}let tp={error:td,warn:td,info:td,debug:td},tm=new WeakMap;function tg(e){let t=e.logger,s=e.logLevel??"off";if(!t)return tp;let n=tm.get(t);if(n&&n[0]===s)return n[1];let r={error:tf("error",t,s),warn:tf("warn",t,s),info:tf("info",t,s),debug:tf("debug",t,s)};return tm.set(t,[s,r]),r}let ty=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e),tw="5.1.1",t_=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator,tb=()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tw,"X-Stainless-OS":tx(Deno.build.os),"X-Stainless-Arch":tv(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tw,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tw,"X-Stainless-OS":tx(globalThis.process.platform??"unknown"),"X-Stainless-Arch":tv(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,n=s[2]||0,r=s[3]||0;return{browser:e,version:`${t}.${n}.${r}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tw,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tw,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},tv=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",tx=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",tS=()=>n??(n=tb());function tA(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function t$(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return tA({start(){},async pull(e){let{done:s,value:n}=await t.next();s?e.close():e.enqueue(n)},async cancel(){await t.return?.()}})}function tI(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function tR(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator]){await e[Symbol.asyncIterator]().return?.();return}let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let tO=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),tk="RFC3986",tj={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},tT=(Object.prototype.hasOwnProperty,Array.isArray),tE=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function tP(e,t){if(tT(e)){let s=[];for(let n=0;n<e.length;n+=1)s.push(t(e[n]));return s}return t(e)}let tN=Object.prototype.hasOwnProperty,tC={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},tM=Array.isArray,tL=Array.prototype.push,tD=function(e,t){tL.apply(e,tM(t)?t:[t])},tB=Date.prototype.toISOString,tF={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,s,n,r)=>{if(0===e.length)return e;let a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===s)return escape(a).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let i="";for(let e=0;e<a.length;e+=1024){let t=a.length>=1024?a.slice(e,e+1024):a,s=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);if(45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||"RFC1738"===r&&(40===n||41===n)){s[s.length]=t.charAt(e);continue}if(n<128){s[s.length]=tE[n];continue}if(n<2048){s[s.length]=tE[192|n>>6]+tE[128|63&n];continue}if(n<55296||n>=57344){s[s.length]=tE[224|n>>12]+tE[128|n>>6&63]+tE[128|63&n];continue}e+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),s[s.length]=tE[240|n>>18]+tE[128|n>>12&63]+tE[128|n>>6&63]+tE[128|63&n]}i+=s.join("")}return i},encodeValuesOnly:!1,format:tk,formatter:tj[tk],indices:!1,serializeDate:e=>tB.call(e),skipNulls:!1,strictNullHandling:!1},tW={};function tq(e){let t;return(r??(r=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function tU(e){let t;return(a??(a=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class tJ{constructor(){i.set(this,void 0),o.set(this,void 0),eV(this,i,new Uint8Array,"f"),eV(this,o,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?tq(e):e;eV(this,i,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),n=0;for(let t of e)s.set(t,n),n+=t.length;return s}([eY(this,i,"f"),s]),"f");let n=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(eY(this,i,"f"),eY(this,o,"f")));){if(t.carriage&&null==eY(this,o,"f")){eV(this,o,t.index,"f");continue}if(null!=eY(this,o,"f")&&(t.index!==eY(this,o,"f")+1||t.carriage)){n.push(tU(eY(this,i,"f").subarray(0,eY(this,o,"f")-1))),eV(this,i,eY(this,i,"f").subarray(eY(this,o,"f")),"f"),eV(this,o,null,"f");continue}let e=null!==eY(this,o,"f")?t.preceding-1:t.preceding,s=tU(eY(this,i,"f").subarray(0,e));n.push(s),eV(this,i,eY(this,i,"f").subarray(t.index),"f"),eV(this,o,null,"f")}return n}flush(){return eY(this,i,"f").length?this.decode("\n"):[]}}i=new WeakMap,o=new WeakMap,tJ.NEWLINE_CHARS=new Set(["\n","\r"]),tJ.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class tX{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let s=!1;return new tX(async function*(){if(s)throw new eZ("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(let s of tH(e,t))if(!n){if(s.data.startsWith("[DONE]")){n=!0;continue}if(null===s.event||s.event.startsWith("response.")||s.event.startsWith("transcript.")){let t;try{t=JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if(t&&t.error)throw new e0(void 0,t.error,void 0,e.headers);yield t}else{let e;try{e=JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if("error"==s.event)throw new e0(void 0,e.error,e.message,void 0);yield{event:s.event,data:e}}}n=!0}catch(e){if(eG(e))return;throw e}finally{n||t.abort()}},t)}static fromReadableStream(e,t){let s=!1;async function*n(){let t=new tJ;for await(let s of tI(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new tX(async function*(){if(s)throw new eZ("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(eG(e))return;throw e}finally{e||t.abort()}},t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=s.next();e.push(n),t.push(n)}return n.shift()}});return[new tX(()=>n(e),this.controller),new tX(()=>n(t),this.controller)]}toReadableStream(){let e;let t=this;return tA({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:n}=await e.next();if(n)return t.close();let r=tq(JSON.stringify(s)+"\n");t.enqueue(r)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*tH(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new eZ("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new eZ("Attempted to iterate over a response with no body")}let s=new tV,n=new tJ;for await(let t of tK(tI(e.body)))for(let e of n.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of n.flush()){let t=s.decode(e);t&&(yield t)}}async function*tK(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let n=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?tq(s):s,r=new Uint8Array(t.length+n.length);for(r.set(t),r.set(n,t.length),t=r;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class tV{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=function(e,t){let s=e.indexOf(t);return -1!==s?[e.substring(0,s),t,e.substring(s+t.length)]:[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}async function tY(e,t){let{response:s,requestLogID:n,retryOfRequestLogID:r,startTime:a}=t,i=await (async()=>{if(t.options.stream)return(tg(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller):tX.fromSSEResponse(s,t.controller);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let n=s.headers.get("content-type"),r=n?.split(";")[0]?.trim();return r?.includes("application/json")||r?.endsWith("+json")?tz(await s.json(),s):await s.text()})();return tg(e).debug(`[${n}] response parsed`,ty({retryOfRequestLogID:r,url:s.url,status:s.status,body:i,durationMs:Date.now()-a})),i}function tz(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class tG extends Promise{constructor(e,t,s=tY){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,l.set(this,void 0),eV(this,l,e,"f")}_thenUnwrap(e){return new tG(eY(this,l,"f"),this.responsePromise,async(t,s)=>tz(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(eY(this,l,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}l=new WeakMap;class tQ{constructor(e,t,s,n){c.set(this,void 0),eV(this,c,e,"f"),this.options=n,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new eZ("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await eY(this,c,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(c=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class tZ extends tG{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await tY(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class t0 extends tQ{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class t1 extends tQ{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){var e;let t=this.getPaginatedItems(),s=t[t.length-1]?.id;return s?{...this.options,query:{..."object"!=typeof(e=this.options.query)?{}:e??{},after:s}}:null}}let t2=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function t3(e,t,s){return t2(),new File(e,t??"unknown_file",s)}function t4(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let t8=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],t5=async(e,t)=>({...e,body:await t9(e.body,t)}),t6=new WeakMap,t9=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=t6.get(t);if(s)return s;let n=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return t6.set(t,n),n}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>ss(s,e,t))),s},t7=e=>e instanceof Blob&&"name"in e,se=e=>"object"==typeof e&&null!==e&&(e instanceof Response||t8(e)||t7(e)),st=e=>{if(se(e))return!0;if(Array.isArray(e))return e.some(st);if(e&&"object"==typeof e){for(let t in e)if(st(e[t]))return!0}return!1},ss=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response)e.append(t,t3([await s.blob()],t4(s)));else if(t8(s))e.append(t,t3([await new Response(t$(s)).blob()],t4(s)));else if(t7(s))e.append(t,s,t4(s));else if(Array.isArray(s))await Promise.all(s.map(s=>ss(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,n])=>ss(e,`${t}[${s}]`,n)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}},sn=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,sr=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&sn(e),sa=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob;async function si(e,t,s){if(t2(),sr(e=await e))return e instanceof File?e:t3([await e.arrayBuffer()],e.name);if(sa(e)){let n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),t3(await so(n),t,s)}let n=await so(e);if(t||(t=t4(e)),!s?.type){let e=n.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return t3(n,t,s)}async function so(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(sn(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(t8(e))for await(let s of e)t.push(...await so(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class sl{constructor(e){this._client=e}}function sc(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let su=((e=sc)=>function(t,...s){let n;if(1===t.length)return t[0];let r=!1,a=t.reduce((t,n,a)=>(/[?#]/.test(n)&&(r=!0),t+n+(a===s.length?"":(r?encodeURIComponent:e)(String(s[a])))),""),i=a.split(/[?#]/,1)[0],o=[],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(n=l.exec(i));)o.push({start:n.index,length:n[0].length});if(o.length>0){let e=0,t=o.reduce((t,s)=>{let n=" ".repeat(s.start-e),r="^".repeat(s.length);return e=s.start+s.length,t+n+r},"");throw new eZ(`Path parameters result in path with invalid segments:
${a}
${t}`)}return a})(sc);class sh extends sl{list(e,t={},s){return this._client.getAPIList(su`/chat/completions/${e}/messages`,t1,{query:t,...s})}}let sd=e=>e?.role==="assistant",sf=e=>e?.role==="tool";class sp{constructor(){u.add(this),this.controller=new AbortController,h.set(this,void 0),d.set(this,()=>{}),f.set(this,()=>{}),p.set(this,void 0),m.set(this,()=>{}),g.set(this,()=>{}),y.set(this,{}),w.set(this,!1),_.set(this,!1),b.set(this,!1),v.set(this,!1),eV(this,h,new Promise((e,t)=>{eV(this,d,e,"f"),eV(this,f,t,"f")}),"f"),eV(this,p,new Promise((e,t)=>{eV(this,m,e,"f"),eV(this,g,t,"f")}),"f"),eY(this,h,"f").catch(()=>{}),eY(this,p,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},eY(this,u,"m",x).bind(this))},0)}_connected(){this.ended||(eY(this,d,"f").call(this),this._emit("connect"))}get ended(){return eY(this,w,"f")}get errored(){return eY(this,_,"f")}get aborted(){return eY(this,b,"f")}abort(){this.controller.abort()}on(e,t){return(eY(this,y,"f")[e]||(eY(this,y,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=eY(this,y,"f")[e];if(!s)return this;let n=s.findIndex(e=>e.listener===t);return n>=0&&s.splice(n,1),this}once(e,t){return(eY(this,y,"f")[e]||(eY(this,y,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{eV(this,v,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){eV(this,v,!0,"f"),await eY(this,p,"f")}_emit(e,...t){if(eY(this,w,"f"))return;"end"===e&&(eV(this,w,!0,"f"),eY(this,m,"f").call(this));let s=eY(this,y,"f")[e];if(s&&(eY(this,y,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];eY(this,v,"f")||s?.length||Promise.reject(e),eY(this,f,"f").call(this,e),eY(this,g,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];eY(this,v,"f")||s?.length||Promise.reject(e),eY(this,f,"f").call(this,e),eY(this,g,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function sm(e){return e?.$brand==="auto-parseable-response-format"}function sg(e){return e?.$brand==="auto-parseable-tool"}function sy(e,t){let s=e.choices.map(e=>{var s;if("length"===e.finish_reason)throw new ts;if("content_filter"===e.finish_reason)throw new tn;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>(function(e,t){let s=e.tools?.find(e=>e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:sg(s)?s.$parseRaw(t.function.arguments):s?.function.strict?JSON.parse(t.function.arguments):null}}})(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(s=e.message.content,t.response_format?.type!=="json_schema"?null:t.response_format?.type==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(s):JSON.parse(s):null):null}}});return{...e,choices:s}}function sw(e){return!!sm(e.response_format)||(e.tools?.some(e=>sg(e)||"function"===e.type&&!0===e.function.strict)??!1)}h=new WeakMap,d=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,_=new WeakMap,b=new WeakMap,v=new WeakMap,u=new WeakSet,x=function(e){if(eV(this,_,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new e1),e instanceof e1)return eV(this,b,!0,"f"),this._emit("abort",e);if(e instanceof eZ)return this._emit("error",e);if(e instanceof Error){let t=new eZ(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new eZ(String(e)))};class s_ extends sp{constructor(){super(...arguments),S.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),sf(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(sd(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new eZ("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),eY(this,S,"m",A).call(this)}async finalMessage(){return await this.done(),eY(this,S,"m",$).call(this)}async finalFunctionToolCall(){return await this.done(),eY(this,S,"m",I).call(this)}async finalFunctionToolCallResult(){return await this.done(),eY(this,S,"m",R).call(this)}async totalUsage(){return await this.done(),eY(this,S,"m",O).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=eY(this,S,"m",$).call(this);t&&this._emit("finalMessage",t);let s=eY(this,S,"m",A).call(this);s&&this._emit("finalContent",s);let n=eY(this,S,"m",I).call(this);n&&this._emit("finalFunctionToolCall",n);let r=eY(this,S,"m",R).call(this);null!=r&&this._emit("finalFunctionToolCallResult",r),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",eY(this,S,"m",O).call(this))}async _createChatCompletion(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eY(this,S,"m",k).call(this,t);let r=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(sy(r,t))}async _runChatCompletion(e,t,s){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){let n="tool",{tool_choice:r="auto",stream:a,...i}=t,o="string"!=typeof r&&r?.function?.name,{maxChatCompletions:l=10}=s||{},c=t.tools.map(e=>{if(sg(e)){if(!e.$callback)throw new eZ("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),u={};for(let e of c)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);let h="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...i,tool_choice:r,tools:h,messages:[...this.messages]},s),a=t.choices[0]?.message;if(!a)throw new eZ("missing message in ChatCompletion response");if(!a.tool_calls?.length)break;for(let e of a.tool_calls){let t;if("function"!==e.type)continue;let s=e.id,{name:r,arguments:a}=e.function,i=u[r];if(i){if(o&&o!==r){let e=`Invalid tool_call: ${JSON.stringify(r)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(r)}. Available options are: ${Object.keys(u).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}try{t="function"==typeof i.parse?await i.parse(a):a}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:n,tool_call_id:s,content:e});continue}let l=await i.function(t,this),c=eY(this,S,"m",j).call(this,l);if(this._addMessage({role:n,tool_call_id:s,content:c}),o)return}}}}S=new WeakSet,A=function(){return eY(this,S,"m",$).call(this).content??null},$=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(sd(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new eZ("stream ended without producing a ChatCompletionMessage with role=assistant")},I=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(sd(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},R=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(sf(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},O=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},k=function(e){if(null!=e.n&&e.n>1)throw new eZ("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},j=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class sb extends s_{static runTools(e,t,s){let n=new sb,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}_addMessage(e,t=!0){super._addMessage(e,t),sd(e)&&e.content&&this._emit("content",e.content)}}let sv={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,ALL:511};class sx extends Error{}class sS extends Error{}let sA=(e,t)=>{let s=e.length,n=0,r=e=>{throw new sx(`${e} at position ${n}`)},a=e=>{throw new sS(`${e} at position ${n}`)},i=()=>(h(),n>=s&&r("Unexpected end of input"),'"'===e[n])?o():"{"===e[n]?l():"["===e[n]?c():"null"===e.substring(n,n+4)||sv.NULL&t&&s-n<4&&"null".startsWith(e.substring(n))?(n+=4,null):"true"===e.substring(n,n+4)||sv.BOOL&t&&s-n<4&&"true".startsWith(e.substring(n))?(n+=4,!0):"false"===e.substring(n,n+5)||sv.BOOL&t&&s-n<5&&"false".startsWith(e.substring(n))?(n+=5,!1):"Infinity"===e.substring(n,n+8)||sv.INFINITY&t&&s-n<8&&"Infinity".startsWith(e.substring(n))?(n+=8,1/0):"-Infinity"===e.substring(n,n+9)||sv.MINUS_INFINITY&t&&1<s-n&&s-n<9&&"-Infinity".startsWith(e.substring(n))?(n+=9,-1/0):"NaN"===e.substring(n,n+3)||sv.NAN&t&&s-n<3&&"NaN".startsWith(e.substring(n))?(n+=3,NaN):u(),o=()=>{let i=n,o=!1;for(n++;n<s&&('"'!==e[n]||o&&"\\"===e[n-1]);)o="\\"===e[n]&&!o,n++;if('"'==e.charAt(n))try{return JSON.parse(e.substring(i,++n-Number(o)))}catch(e){a(String(e))}else if(sv.STR&t)try{return JSON.parse(e.substring(i,n-Number(o))+'"')}catch(t){return JSON.parse(e.substring(i,e.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},l=()=>{n++,h();let a={};try{for(;"}"!==e[n];){if(h(),n>=s&&sv.OBJ&t)return a;let r=o();h(),n++;try{let e=i();Object.defineProperty(a,r,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(sv.OBJ&t)return a;throw e}h(),","===e[n]&&n++}}catch(e){if(sv.OBJ&t)return a;r("Expected '}' at end of object")}return n++,a},c=()=>{n++;let s=[];try{for(;"]"!==e[n];)s.push(i()),h(),","===e[n]&&n++}catch(e){if(sv.ARR&t)return s;r("Expected ']' at end of array")}return n++,s},u=()=>{if(0===n){"-"===e&&sv.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e)}catch(s){if(sv.NUM&t)try{if("."===e[e.length-1])return JSON.parse(e.substring(0,e.lastIndexOf(".")));return JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}a(String(s))}}let i=n;for("-"===e[n]&&n++;e[n]&&!",]}".includes(e[n]);)n++;n!=s||sv.NUM&t||r("Unterminated number literal");try{return JSON.parse(e.substring(i,n))}catch(s){"-"===e.substring(i,n)&&sv.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e.substring(i,e.lastIndexOf("e")))}catch(e){a(String(e))}}},h=()=>{for(;n<s&&" \n\r	".includes(e[n]);)n++};return i()},s$=e=>(function(e,t=sv.ALL){if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return sA(e.trim(),t)})(e,sv.ALL^sv.NUM);class sI extends s_{constructor(e){super(),T.add(this),E.set(this,void 0),P.set(this,void 0),N.set(this,void 0),eV(this,E,e,"f"),eV(this,P,[],"f")}get currentChatCompletionSnapshot(){return eY(this,N,"f")}static fromReadableStream(e){let t=new sI(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){let n=new sI(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,s){super._createChatCompletion;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eY(this,T,"m",C).call(this);let r=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});for await(let e of(this._connected(),r))eY(this,T,"m",L).call(this,e);if(r.controller.signal?.aborted)throw new e1;return this._addChatCompletion(eY(this,T,"m",F).call(this))}async _fromReadableStream(e,t){let s;let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eY(this,T,"m",C).call(this),this._connected();let r=tX.fromReadableStream(e,this.controller);for await(let e of r)s&&s!==e.id&&this._addChatCompletion(eY(this,T,"m",F).call(this)),eY(this,T,"m",L).call(this,e),s=e.id;if(r.controller.signal?.aborted)throw new e1;return this._addChatCompletion(eY(this,T,"m",F).call(this))}[(E=new WeakMap,P=new WeakMap,N=new WeakMap,T=new WeakSet,C=function(){this.ended||eV(this,N,void 0,"f")},M=function(e){let t=eY(this,P,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},eY(this,P,"f")[e.index]=t),t},L=function(e){if(this.ended)return;let t=eY(this,T,"m",q).call(this,e);for(let s of(this._emit("chunk",e,t),e.choices)){let e=t.choices[s.index];null!=s.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",s.delta.content,e.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=s.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:e.message.refusal}),s.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:e.logprobs?.content??[]}),s.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let n=eY(this,T,"m",M).call(this,e);for(let t of(e.finish_reason&&(eY(this,T,"m",B).call(this,e),null!=n.current_tool_call_index&&eY(this,T,"m",D).call(this,e,n.current_tool_call_index)),s.delta.tool_calls??[]))n.current_tool_call_index!==t.index&&(eY(this,T,"m",B).call(this,e),null!=n.current_tool_call_index&&eY(this,T,"m",D).call(this,e,n.current_tool_call_index)),n.current_tool_call_index=t.index;for(let t of s.delta.tool_calls??[]){let s=e.message.tool_calls?.[t.index];s?.type&&(s?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:s.function?.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):s?.type)}}},D=function(e,t){if(eY(this,T,"m",M).call(this,e).done_tool_calls.has(t))return;let s=e.message.tool_calls?.[t];if(!s)throw Error("no tool call snapshot");if(!s.type)throw Error("tool call snapshot missing `type`");if("function"===s.type){let e=eY(this,E,"f")?.tools?.find(e=>"function"===e.type&&e.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:t,arguments:s.function.arguments,parsed_arguments:sg(e)?e.$parseRaw(s.function.arguments):e?.function.strict?JSON.parse(s.function.arguments):null})}else s.type},B=function(e){let t=eY(this,T,"m",M).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let s=eY(this,T,"m",W).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},F=function(){if(this.ended)throw new eZ("stream has ended, this shouldn't happen");let e=eY(this,N,"f");if(!e)throw new eZ("request ended without sending any chunks");return eV(this,N,void 0,"f"),eV(this,P,[],"f"),function(e,t){var s;let{id:n,choices:r,created:a,model:i,system_fingerprint:o,...l}=e;return s={...l,id:n,choices:r.map(({message:t,finish_reason:s,index:n,logprobs:r,...a})=>{if(!s)throw new eZ(`missing finish_reason for choice ${n}`);let{content:i=null,function_call:o,tool_calls:l,...c}=t,u=t.role;if(!u)throw new eZ(`missing role for choice ${n}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new eZ(`missing function_call.arguments for choice ${n}`);if(!l)throw new eZ(`missing function_call.name for choice ${n}`);return{...a,message:{content:i,function_call:{arguments:e,name:l},role:u,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}return l?{...a,index:n,finish_reason:s,logprobs:r,message:{...c,role:u,content:i,refusal:t.refusal??null,tool_calls:l.map((t,s)=>{let{function:r,type:a,id:i,...o}=t,{arguments:l,name:c,...u}=r||{};if(null==i)throw new eZ(`missing choices[${n}].tool_calls[${s}].id
${sR(e)}`);if(null==a)throw new eZ(`missing choices[${n}].tool_calls[${s}].type
${sR(e)}`);if(null==c)throw new eZ(`missing choices[${n}].tool_calls[${s}].function.name
${sR(e)}`);if(null==l)throw new eZ(`missing choices[${n}].tool_calls[${s}].function.arguments
${sR(e)}`);return{...o,id:i,type:a,function:{...u,name:c,arguments:l}}})}}:{...a,message:{...c,content:i,role:u,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}),created:a,model:i,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&sw(t)?sy(s,t):{...s,choices:s.choices.map(e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,eY(this,E,"f"))},W=function(){let e=eY(this,E,"f")?.response_format;return sm(e)?e:null},q=function(e){var t,s,n,r;let a=eY(this,N,"f"),{choices:i,...o}=e;for(let{delta:i,finish_reason:l,index:c,logprobs:u=null,...h}of(a?Object.assign(a,o):a=eV(this,N,{...o,choices:[]},"f"),e.choices)){let e=a.choices[c];if(e||(e=a.choices[c]={finish_reason:l,index:c,message:{},logprobs:u,...h}),u){if(e.logprobs){let{content:n,refusal:r,...a}=u;Object.assign(e.logprobs,a),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),r&&((s=e.logprobs).refusal??(s.refusal=[]),e.logprobs.refusal.push(...r))}else e.logprobs=Object.assign({},u)}if(l&&(e.finish_reason=l,eY(this,E,"f")&&sw(eY(this,E,"f")))){if("length"===l)throw new ts;if("content_filter"===l)throw new tn}if(Object.assign(e,h),!i)continue;let{content:o,refusal:d,function_call:f,role:p,tool_calls:m,...g}=i;if(Object.assign(e.message,g),d&&(e.message.refusal=(e.message.refusal||"")+d),p&&(e.message.role=p),f&&(e.message.function_call?(f.name&&(e.message.function_call.name=f.name),f.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=f.arguments)):e.message.function_call=f),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&eY(this,T,"m",W).call(this)&&(e.message.parsed=s$(e.message.content))),m)for(let{index:t,id:s,type:n,function:a,...i}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let o=(r=e.message.tool_calls)[t]??(r[t]={});Object.assign(o,i),s&&(o.id=s),n&&(o.type=n),a&&(o.function??(o.function={name:a.name??"",arguments:""})),a?.name&&(o.function.name=a.name),a?.arguments&&(o.function.arguments+=a.arguments,function(e,t){if(!e)return!1;let s=e.tools?.find(e=>e.function?.name===t.function.name);return sg(s)||s?.function.strict||!1}(eY(this,E,"f"),o)&&(o.function.parsed_arguments=s$(o.function.arguments)))}}return a},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("chunk",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new tX(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function sR(e){return JSON.stringify(e)}class sO extends sI{static fromReadableStream(e){let t=new sO(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,s){let n=new sO(t),r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}}class sk extends sl{constructor(){super(...arguments),this.messages=new sh(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(su`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post(su`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",t1,{query:e,...t})}delete(e,t){return this._client.delete(su`/chat/completions/${e}`,t)}parse(e,t){return function(e){for(let t of e??[]){if("function"!==t.type)throw new eZ(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new eZ(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>sy(t,e))}runTools(e,t){return e.stream?sO.runTools(this._client,e,t):sb.runTools(this._client,e,t)}stream(e,t){return sI.createChatCompletion(this._client,e,t)}}sk.Messages=sh;class sj extends sl{constructor(){super(...arguments),this.completions=new sk(this._client)}}sj.Completions=sk;let sT=Symbol("brand.privateNullableHeaders"),sE=Array.isArray,sP=e=>{let t=new Headers,s=new Set;for(let n of e){let e=new Set;for(let[r,a]of function*(e){let t;if(!e)return;if(sT in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let n of(e instanceof Headers?t=e.entries():sE(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=n[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=sE(n[1])?n[1]:[n[1]],r=!1;for(let n of t)void 0!==n&&(s&&!r&&(r=!0,yield[e,null]),yield[e,n])}}(n)){let n=r.toLowerCase();e.has(n)||(t.delete(r),e.add(n)),null===a?(t.delete(r),s.add(n)):(t.append(r,a),s.delete(n))}}return{[sT]:!0,values:t,nulls:s}};class sN extends sl{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:sP([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class sC extends sl{create(e,t){return this._client.post("/audio/transcriptions",t5({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class sM extends sl{create(e,t){return this._client.post("/audio/translations",t5({body:e,...t,__metadata:{model:e.model}},this._client))}}class sL extends sl{constructor(){super(...arguments),this.transcriptions=new sC(this._client),this.translations=new sM(this._client),this.speech=new sN(this._client)}}sL.Transcriptions=sC,sL.Translations=sM,sL.Speech=sN;class sD extends sl{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(su`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",t1,{query:e,...t})}cancel(e,t){return this._client.post(su`/batches/${e}/cancel`,t)}}class sB extends sl{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:sP([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(su`/assistants/${e}`,{...t,headers:sP([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(su`/assistants/${e}`,{body:t,...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",t1,{query:e,...t,headers:sP([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(su`/assistants/${e}`,{...t,headers:sP([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sF extends sl{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:sP([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sW extends sl{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:sP([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sq extends sl{constructor(){super(...arguments),this.sessions=new sF(this._client),this.transcriptionSessions=new sW(this._client)}}sq.Sessions=sF,sq.TranscriptionSessions=sW;class sU extends sl{create(e,t,s){return this._client.post(su`/threads/${e}/messages`,{body:t,...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(su`/threads/${n}/messages/${e}`,{...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(su`/threads/${n}/messages/${e}`,{body:r,...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(su`/threads/${e}/messages`,t1,{query:t,...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{thread_id:n}=t;return this._client.delete(su`/threads/${n}/messages/${e}`,{...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class sJ extends sl{retrieve(e,t,s){let{thread_id:n,run_id:r,...a}=t;return this._client.get(su`/threads/${n}/runs/${r}/steps/${e}`,{query:a,...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t,s){let{thread_id:n,...r}=t;return this._client.getAPIList(su`/threads/${n}/runs/${e}/steps`,t1,{query:r,...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}let sX=e=>{if("undefined"!=typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),s=t.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=t.charCodeAt(e);return Array.from(new Float32Array(n.buffer))}};class sH extends sp{constructor(){super(...arguments),U.add(this),X.set(this,[]),H.set(this,{}),K.set(this,{}),V.set(this,void 0),Y.set(this,void 0),z.set(this,void 0),G.set(this,void 0),Q.set(this,void 0),Z.set(this,void 0),ee.set(this,void 0),et.set(this,void 0),es.set(this,void 0)}[(X=new WeakMap,H=new WeakMap,K=new WeakMap,V=new WeakMap,Y=new WeakMap,z=new WeakMap,G=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,et=new WeakMap,es=new WeakMap,U=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new J;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=tX.fromReadableStream(e,this.controller);for await(let e of n)eY(this,U,"m",en).call(this,e);if(n.controller.signal?.aborted)throw new e1;return this._addRun(eY(this,U,"m",er).call(this))}toReadableStream(){return new tX(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,n){let r=new J;return r._run(()=>r._runToolAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createToolAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let a={...s,stream:!0},i=await e.submitToolOutputs(t,a,{...n,signal:this.controller.signal});for await(let e of(this._connected(),i))eY(this,U,"m",en).call(this,e);if(i.controller.signal?.aborted)throw new e1;return this._addRun(eY(this,U,"m",er).call(this))}static createThreadAssistantStream(e,t,s){let n=new J;return n._run(()=>n._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,s,n){let r=new J;return r._run(()=>r._runAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return eY(this,ee,"f")}currentRun(){return eY(this,et,"f")}currentMessageSnapshot(){return eY(this,V,"f")}currentRunStepSnapshot(){return eY(this,es,"f")}async finalRunSteps(){return await this.done(),Object.values(eY(this,H,"f"))}async finalMessages(){return await this.done(),Object.values(eY(this,K,"f"))}async finalRun(){if(await this.done(),!eY(this,Y,"f"))throw Error("Final run was not received.");return eY(this,Y,"f")}async _createThreadAssistantStream(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let r={...t,stream:!0},a=await e.createAndRun(r,{...s,signal:this.controller.signal});for await(let e of(this._connected(),a))eY(this,U,"m",en).call(this,e);if(a.controller.signal?.aborted)throw new e1;return this._addRun(eY(this,U,"m",er).call(this))}async _createAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let a={...s,stream:!0},i=await e.create(t,a,{...n,signal:this.controller.signal});for await(let e of(this._connected(),i))eY(this,U,"m",en).call(this,e);if(i.controller.signal?.aborted)throw new e1;return this._addRun(eY(this,U,"m",er).call(this))}static accumulateDelta(e,t){for(let[s,n]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=n;continue}let t=e[s];if(null==t||"index"===s||"type"===s){e[s]=n;continue}if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else if(ti(t)&&ti(n))t=this.accumulateDelta(t,n);else if(Array.isArray(t)&&Array.isArray(n)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...n);continue}for(let e of n){if(!ti(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let s=e.index;if(null==s)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof s)throw Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);let n=t[s];null==n?t.push(e):t[s]=this.accumulateDelta(n,e)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${n}, accValue: ${t}`);e[s]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,n){return await this._createAssistantStream(t,e,s,n)}async _runToolAssistantStream(e,t,s,n){return await this._createToolAssistantStream(t,e,s,n)}}J=sH,en=function(e){if(!this.ended)switch(eV(this,ee,e,"f"),eY(this,U,"m",eo).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":eY(this,U,"m",eh).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eY(this,U,"m",ei).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":eY(this,U,"m",ea).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},er=function(){if(this.ended)throw new eZ("stream has ended, this shouldn't happen");if(!eY(this,Y,"f"))throw Error("Final run has not been received");return eY(this,Y,"f")},ea=function(e){let[t,s]=eY(this,U,"m",ec).call(this,e,eY(this,V,"f"));for(let e of(eV(this,V,t,"f"),eY(this,K,"f")[t.id]=t,s)){let s=t.content[e.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,n=t.content[s.index];if(n&&"text"==n.type)this._emit("textDelta",e,n.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=eY(this,z,"f")){if(eY(this,G,"f"))switch(eY(this,G,"f").type){case"text":this._emit("textDone",eY(this,G,"f").text,eY(this,V,"f"));break;case"image_file":this._emit("imageFileDone",eY(this,G,"f").image_file,eY(this,V,"f"))}eV(this,z,s.index,"f")}eV(this,G,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==eY(this,z,"f")){let t=e.data.content[eY(this,z,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,eY(this,V,"f"));break;case"text":this._emit("textDone",t.text,eY(this,V,"f"))}}eY(this,V,"f")&&this._emit("messageDone",e.data),eV(this,V,void 0,"f")}},ei=function(e){let t=eY(this,U,"m",el).call(this,e);switch(eV(this,es,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of s.step_details.tool_calls)e.index==eY(this,Q,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(eY(this,Z,"f")&&this._emit("toolCallDone",eY(this,Z,"f")),eV(this,Q,e.index,"f"),eV(this,Z,t.step_details.tool_calls[e.index],"f"),eY(this,Z,"f")&&this._emit("toolCallCreated",eY(this,Z,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eV(this,es,void 0,"f"),"tool_calls"==e.data.step_details.type&&eY(this,Z,"f")&&(this._emit("toolCallDone",eY(this,Z,"f")),eV(this,Z,void 0,"f")),this._emit("runStepDone",e.data,t)}},eo=function(e){eY(this,X,"f").push(e),this._emit("event",e)},el=function(e){switch(e.event){case"thread.run.step.created":return eY(this,H,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=eY(this,H,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){let n=J.accumulateDelta(t,s.delta);eY(this,H,"f")[e.data.id]=n}return eY(this,H,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":eY(this,H,"f")[e.data.id]=e.data}if(eY(this,H,"f")[e.data.id])return eY(this,H,"f")[e.data.id];throw Error("No snapshot available")},ec=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let e of n.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=eY(this,U,"m",eu).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},eu=function(e,t){return J.accumulateDelta(t,e)},eh=function(e){switch(eV(this,et,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":eV(this,Y,e.data,"f"),eY(this,Z,"f")&&(this._emit("toolCallDone",eY(this,Z,"f")),eV(this,Z,void 0,"f"))}};class sK extends sl{constructor(){super(...arguments),this.steps=new sJ(this._client)}create(e,t,s){let{include:n,...r}=t;return this._client.post(su`/threads/${e}/runs`,{query:{include:n},body:r,...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(su`/threads/${n}/runs/${e}`,{...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(su`/threads/${n}/runs/${e}`,{body:r,...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(su`/threads/${e}/runs`,t1,{query:t,...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{thread_id:n}=t;return this._client.post(su`/threads/${n}/runs/${e}/cancel`,{...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(n.id,{thread_id:e},s)}createAndStream(e,t,s){return sH.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){let n=sP([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:a}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...n}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let i=5e3;if(s?.pollIntervalMs)i=s.pollIntervalMs;else{let e=a.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await tc(i);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,s){return sH.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){let{thread_id:n,...r}=t;return this._client.post(su`/threads/${n}/runs/${e}/submit_tool_outputs`,{body:r,...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,s){let n=await this.submitToolOutputs(e,t,s);return await this.poll(n.id,t,s)}submitToolOutputsStream(e,t,s){return sH.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}}sK.Steps=sJ;class sV extends sl{constructor(){super(...arguments),this.runs=new sK(this._client),this.messages=new sU(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:sP([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(su`/threads/${e}`,{...t,headers:sP([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(su`/threads/${e}`,{body:t,...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t){return this._client.delete(su`/threads/${e}`,{...t,headers:sP([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:sP([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return sH.createThreadAssistantStream(e,this._client.beta.threads,t)}}sV.Runs=sK,sV.Messages=sU;class sY extends sl{constructor(){super(...arguments),this.realtime=new sq(this._client),this.assistants=new sB(this._client),this.threads=new sV(this._client)}}sY.Realtime=sq,sY.Assistants=sB,sY.Threads=sV;class sz extends sl{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class sG extends sl{retrieve(e,t,s){let{container_id:n}=t;return this._client.get(su`/containers/${n}/files/${e}/content`,{...s,headers:sP([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}}class sQ extends sl{constructor(){super(...arguments),this.content=new sG(this._client)}create(e,t,s){return this._client.post(su`/containers/${e}/files`,t5({body:t,...s},this._client))}retrieve(e,t,s){let{container_id:n}=t;return this._client.get(su`/containers/${n}/files/${e}`,s)}list(e,t={},s){return this._client.getAPIList(su`/containers/${e}/files`,t1,{query:t,...s})}delete(e,t,s){let{container_id:n}=t;return this._client.delete(su`/containers/${n}/files/${e}`,{...s,headers:sP([{Accept:"*/*"},s?.headers])})}}sQ.Content=sG;class sZ extends sl{constructor(){super(...arguments),this.files=new sQ(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(su`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",t1,{query:e,...t})}delete(e,t){return this._client.delete(su`/containers/${e}`,{...t,headers:sP([{Accept:"*/*"},t?.headers])})}}sZ.Files=sQ;class s0 extends sl{create(e,t){let s=!!e.encoding_format,n=s?e.encoding_format:"base64";s&&tg(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let r=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return s?r:(tg(this._client).debug("embeddings/decoding base64 embeddings from base64"),r._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=sX(t)}),e)))}}class s1 extends sl{retrieve(e,t,s){let{eval_id:n,run_id:r}=t;return this._client.get(su`/evals/${n}/runs/${r}/output_items/${e}`,s)}list(e,t,s){let{eval_id:n,...r}=t;return this._client.getAPIList(su`/evals/${n}/runs/${e}/output_items`,t1,{query:r,...s})}}class s2 extends sl{constructor(){super(...arguments),this.outputItems=new s1(this._client)}create(e,t,s){return this._client.post(su`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){let{eval_id:n}=t;return this._client.get(su`/evals/${n}/runs/${e}`,s)}list(e,t={},s){return this._client.getAPIList(su`/evals/${e}/runs`,t1,{query:t,...s})}delete(e,t,s){let{eval_id:n}=t;return this._client.delete(su`/evals/${n}/runs/${e}`,s)}cancel(e,t,s){let{eval_id:n}=t;return this._client.post(su`/evals/${n}/runs/${e}`,s)}}s2.OutputItems=s1;class s3 extends sl{constructor(){super(...arguments),this.runs=new s2(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(su`/evals/${e}`,t)}update(e,t,s){return this._client.post(su`/evals/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",t1,{query:e,...t})}delete(e,t){return this._client.delete(su`/evals/${e}`,t)}}s3.Runs=s2;class s4 extends sl{create(e,t){return this._client.post("/files",t5({body:e,...t},this._client))}retrieve(e,t){return this._client.get(su`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",t1,{query:e,...t})}delete(e,t){return this._client.delete(su`/files/${e}`,t)}content(e,t){return this._client.get(su`/files/${e}/content`,{...t,headers:sP([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){let n=new Set(["processed","error","deleted"]),r=Date.now(),a=await this.retrieve(e);for(;!a.status||!n.has(a.status);)if(await tc(t),a=await this.retrieve(e),Date.now()-r>s)throw new e3({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return a}}class s8 extends sl{}class s5 extends sl{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class s6 extends sl{constructor(){super(...arguments),this.graders=new s5(this._client)}}s6.Graders=s5;class s9 extends sl{create(e,t,s){return this._client.getAPIList(su`/fine_tuning/checkpoints/${e}/permissions`,t0,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get(su`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}delete(e,t,s){let{fine_tuned_model_checkpoint:n}=t;return this._client.delete(su`/fine_tuning/checkpoints/${n}/permissions/${e}`,s)}}class s7 extends sl{constructor(){super(...arguments),this.permissions=new s9(this._client)}}s7.Permissions=s9;class ne extends sl{list(e,t={},s){return this._client.getAPIList(su`/fine_tuning/jobs/${e}/checkpoints`,t1,{query:t,...s})}}class nt extends sl{constructor(){super(...arguments),this.checkpoints=new ne(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(su`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",t1,{query:e,...t})}cancel(e,t){return this._client.post(su`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return this._client.getAPIList(su`/fine_tuning/jobs/${e}/events`,t1,{query:t,...s})}pause(e,t){return this._client.post(su`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(su`/fine_tuning/jobs/${e}/resume`,t)}}nt.Checkpoints=ne;class ns extends sl{constructor(){super(...arguments),this.methods=new s8(this._client),this.jobs=new nt(this._client),this.checkpoints=new s7(this._client),this.alpha=new s6(this._client)}}ns.Methods=s8,ns.Jobs=nt,ns.Checkpoints=s7,ns.Alpha=s6;class nn extends sl{}class nr extends sl{constructor(){super(...arguments),this.graderModels=new nn(this._client)}}nr.GraderModels=nn;class na extends sl{createVariation(e,t){return this._client.post("/images/variations",t5({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",t5({body:e,...t},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class ni extends sl{retrieve(e,t){return this._client.get(su`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",t0,e)}delete(e,t){return this._client.delete(su`/models/${e}`,t)}}class no extends sl{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function nl(e,t){let s=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var s,n,r;let a=(s=e.tools??[],n=t.name,s.find(e=>"function"===e.type&&e.name===n));return{...t,...t,parsed_arguments:(r=a,r?.$brand==="auto-parseable-tool")?a.$parseRaw(t.arguments):a?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let s=e.content.map(e=>{var s;return"output_text"===e.type?{...e,parsed:(s=e.text,t.text?.format?.type!=="json_schema"?null:"$parseRaw"in t.text?.format?(t.text?.format).$parseRaw(s):JSON.parse(s))}:e});return{...e,content:s}}return e}),n=Object.assign({},e,{output:s});return Object.getOwnPropertyDescriptor(e,"output_text")||nc(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let e of n.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),n}function nc(e){let t=[];for(let s of e.output)if("message"===s.type)for(let e of s.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}class nu extends sp{constructor(e){super(),ed.add(this),ef.set(this,void 0),ep.set(this,void 0),em.set(this,void 0),eV(this,ef,e,"f")}static createResponse(e,t,s){let n=new nu(t);return n._run(()=>n._createOrRetrieveResponse(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createOrRetrieveResponse(e,t,s){let n;let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),eY(this,ed,"m",eg).call(this);let a=null;for await(let r of("response_id"in t?(n=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):n=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected(),n))eY(this,ed,"m",ey).call(this,r,a);if(n.controller.signal?.aborted)throw new e1;return eY(this,ed,"m",ew).call(this)}[(ef=new WeakMap,ep=new WeakMap,em=new WeakMap,ed=new WeakSet,eg=function(){this.ended||eV(this,ep,void 0,"f")},ey=function(e,t){if(this.ended)return;let s=(e,s)=>{(null==t||s.sequence_number>t)&&this._emit(e,s)},n=eY(this,ed,"m",e_).call(this,e);switch(s("event",e),e.type){case"response.output_text.delta":{let t=n.output[e.output_index];if(!t)throw new eZ(`missing output at index ${e.output_index}`);if("message"===t.type){let n=t.content[e.content_index];if(!n)throw new eZ(`missing content at index ${e.content_index}`);if("output_text"!==n.type)throw new eZ(`expected content to be 'output_text', got ${n.type}`);s("response.output_text.delta",{...e,snapshot:n.text})}break}case"response.function_call_arguments.delta":{let t=n.output[e.output_index];if(!t)throw new eZ(`missing output at index ${e.output_index}`);"function_call"===t.type&&s("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:s(e.type,e)}},ew=function(){if(this.ended)throw new eZ("stream has ended, this shouldn't happen");let e=eY(this,ep,"f");if(!e)throw new eZ("request ended without sending any events");eV(this,ep,void 0,"f");let t=function(e,t){return t&&sm(t.text?.format)?nl(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,eY(this,ef,"f"));return eV(this,em,t,"f"),t},e_=function(e){let t=eY(this,ep,"f");if(!t){if("response.created"!==e.type)throw new eZ(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return eV(this,ep,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let s=t.output[e.output_index];if(!s)throw new eZ(`missing output at index ${e.output_index}`);"message"===s.type&&s.content.push(e.part);break}case"response.output_text.delta":{let s=t.output[e.output_index];if(!s)throw new eZ(`missing output at index ${e.output_index}`);if("message"===s.type){let t=s.content[e.content_index];if(!t)throw new eZ(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new eZ(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let s=t.output[e.output_index];if(!s)throw new eZ(`missing output at index ${e.output_index}`);"function_call"===s.type&&(s.arguments+=e.delta);break}case"response.completed":eV(this,ep,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=eY(this,em,"f");if(!e)throw new eZ("stream ended without producing a ChatCompletion");return e}}class nh extends sl{list(e,t={},s){return this._client.getAPIList(su`/responses/${e}/input_items`,t1,{query:t,...s})}}class nd extends sl{constructor(){super(...arguments),this.inputItems=new nh(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&nc(e),e))}retrieve(e,t={},s){return this._client.get(su`/responses/${e}`,{query:t,...s,stream:t?.stream??!1})}delete(e,t){return this._client.delete(su`/responses/${e}`,{...t,headers:sP([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>nl(t,e))}stream(e,t){return nu.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(su`/responses/${e}/cancel`,t)}}nd.InputItems=nh;class nf extends sl{create(e,t,s){return this._client.post(su`/uploads/${e}/parts`,t5({body:t,...s},this._client))}}class np extends sl{constructor(){super(...arguments),this.parts=new nf(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(su`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(su`/uploads/${e}/complete`,{body:t,...s})}}np.Parts=nf;let nm=async e=>{let t=await Promise.allSettled(e),s=t.filter(e=>"rejected"===e.status);if(s.length){for(let e of s)console.error(e.reason);throw Error(`${s.length} promise(s) failed - see the above errors`)}let n=[];for(let e of t)"fulfilled"===e.status&&n.push(e.value);return n};class ng extends sl{create(e,t,s){return this._client.post(su`/vector_stores/${e}/file_batches`,{body:t,...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(su`/vector_stores/${n}/file_batches/${e}`,{...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{vector_store_id:n}=t;return this._client.post(su`/vector_stores/${n}/file_batches/${e}/cancel`,{...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t);return await this.poll(e,n.id,s)}listFiles(e,t,s){let{vector_store_id:n,...r}=t;return this._client.getAPIList(su`/vector_stores/${n}/file_batches/${e}/files`,t1,{query:r,...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async poll(e,t,s){let n=sP([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:a}=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse();switch(r.status){case"in_progress":let i=5e3;if(s?.pollIntervalMs)i=s.pollIntervalMs;else{let e=a.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await tc(i);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},n){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let r=Math.min(n?.maxConcurrency??5,t.length),a=this._client,i=t.values(),o=[...s];async function l(e){for(let t of e){let e=await a.files.create({file:t,purpose:"assistants"},n);o.push(e.id)}}let c=Array(r).fill(i).map(l);return await nm(c),await this.createAndPoll(e,{file_ids:o})}}class ny extends sl{create(e,t,s){return this._client.post(su`/vector_stores/${e}/files`,{body:t,...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(su`/vector_stores/${n}/files/${e}`,{...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{vector_store_id:n,...r}=t;return this._client.post(su`/vector_stores/${n}/files/${e}`,{body:r,...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(su`/vector_stores/${e}/files`,t1,{query:t,...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{vector_store_id:n}=t;return this._client.delete(su`/vector_stores/${n}/files/${e}`,{...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(e,n.id,s)}async poll(e,t,s){let n=sP([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let r=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse(),a=r.data;switch(a.status){case"in_progress":let i=5e3;if(s?.pollIntervalMs)i=s.pollIntervalMs;else{let e=r.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await tc(i);break;case"failed":case"completed":return a}}}async upload(e,t,s){let n=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:n.id},s)}async uploadAndPoll(e,t,s){let n=await this.upload(e,t,s);return await this.poll(e,n.id,s)}content(e,t,s){let{vector_store_id:n}=t;return this._client.getAPIList(su`/vector_stores/${n}/files/${e}/content`,t0,{...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class nw extends sl{constructor(){super(...arguments),this.files=new ny(this._client),this.fileBatches=new ng(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:sP([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(su`/vector_stores/${e}`,{...t,headers:sP([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(su`/vector_stores/${e}`,{body:t,...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",t1,{query:e,...t,headers:sP([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(su`/vector_stores/${e}`,{...t,headers:sP([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,s){return this._client.getAPIList(su`/vector_stores/${e}/search`,t0,{body:t,method:"post",...s,headers:sP([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}nw.Files=ny,nw.FileBatches=ng;let n_=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class nb{constructor({baseURL:e=n_("OPENAI_BASE_URL"),apiKey:t=n_("OPENAI_API_KEY"),organization:s=n_("OPENAI_ORG_ID")??null,project:n=n_("OPENAI_PROJECT_ID")??null,...r}={}){if(ev.set(this,void 0),this.completions=new sz(this),this.chat=new sj(this),this.embeddings=new s0(this),this.files=new s4(this),this.images=new na(this),this.audio=new sL(this),this.moderations=new no(this),this.models=new ni(this),this.fineTuning=new ns(this),this.graders=new nr(this),this.vectorStores=new nw(this),this.beta=new sY(this),this.batches=new sD(this),this.uploads=new np(this),this.responses=new nd(this),this.evals=new s3(this),this.containers=new sZ(this),void 0===t)throw new eZ("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let a={apiKey:t,organization:s,project:n,...r,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&t_())throw new eZ("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=a.baseURL,this.timeout=a.timeout??eb.DEFAULT_TIMEOUT,this.logger=a.logger??console;let i="warn";this.logLevel=i,this.logLevel=th(a.logLevel,"ClientOptions.logLevel",this)??th(n_("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??i,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),eV(this,ev,tO,"f"),this._options=a,this.apiKey=t,this.organization=s,this.project=n}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}authHeaders(e){return sP([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let s,n=e,r=function(e=tF){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let s=e.charset||tF.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=tk;if(void 0!==e.format){if(!tN.call(tj,e.format))throw TypeError("Unknown format option provided.");n=e.format}let r=tj[n],a=tF.filter;if(("function"==typeof e.filter||tM(e.filter))&&(a=e.filter),t=e.arrayFormat&&e.arrayFormat in tC?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":tF.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let i=void 0===e.allowDots?!0==!!e.encodeDotInKeys||tF.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:tF.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:tF.allowEmptyArrays,arrayFormat:t,charset:s,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:tF.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?tF.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:tF.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:tF.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:tF.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:tF.encodeValuesOnly,filter:a,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:tF.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:tF.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:tF.strictNullHandling}}(t);"function"==typeof r.filter?n=(0,r.filter)("",n):tM(r.filter)&&(s=r.filter);let a=[];if("object"!=typeof n||null===n)return"";let i=tC[r.arrayFormat],o="comma"===i&&r.commaRoundTrip;s||(s=Object.keys(n)),r.sort&&s.sort(r.sort);let l=new WeakMap;for(let e=0;e<s.length;++e){let t=s[e];r.skipNulls&&null===n[t]||tD(a,function e(t,s,n,r,a,i,o,l,c,u,h,d,f,p,m,g,y,w){var _,b;let v,x=t,S=w,A=0,$=!1;for(;void 0!==(S=S.get(tW))&&!$;){let e=S.get(t);if(A+=1,void 0!==e){if(e===A)throw RangeError("Cyclic object value");$=!0}void 0===S.get(tW)&&(A=0)}if("function"==typeof u?x=u(s,x):x instanceof Date?x=f?.(x):"comma"===n&&tM(x)&&(x=tP(x,function(e){return e instanceof Date?f?.(e):e})),null===x){if(i)return c&&!g?c(s,tF.encoder,y,"key",p):s;x=""}if("string"==typeof(_=x)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||(b=x)&&"object"==typeof b&&b.constructor&&b.constructor.isBuffer&&b.constructor.isBuffer(b)){if(c){let e=g?s:c(s,tF.encoder,y,"key",p);return[m?.(e)+"="+m?.(c(x,tF.encoder,y,"value",p))]}return[m?.(s)+"="+m?.(String(x))]}let I=[];if(void 0===x)return I;if("comma"===n&&tM(x))g&&c&&(x=tP(x,c)),v=[{value:x.length>0?x.join(",")||null:void 0}];else if(tM(u))v=u;else{let e=Object.keys(x);v=h?e.sort(h):e}let R=l?String(s).replace(/\./g,"%2E"):String(s),O=r&&tM(x)&&1===x.length?R+"[]":R;if(a&&tM(x)&&0===x.length)return O+"[]";for(let s=0;s<v.length;++s){let _=v[s],b="object"==typeof _&&void 0!==_.value?_.value:x[_];if(o&&null===b)continue;let S=d&&l?_.replace(/\./g,"%2E"):_,$=tM(x)?"function"==typeof n?n(O,S):O:O+(d?"."+S:"["+S+"]");w.set(t,A);let R=new WeakMap;R.set(tW,w),tD(I,e(b,$,n,r,a,i,o,l,"comma"===n&&g&&tM(x)?null:c,u,h,d,f,p,m,g,y,R))}return I}(n[t],t,i,o,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}let c=a.join(r.delimiter),u=!0===r.addQueryPrefix?"?":"";return r.charsetSentinel&&("iso-8859-1"===r.charset?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),c.length>0?u+c:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${tw}`}defaultIdempotencyKey(){return`stainless-node-retry-${ez()}`}makeStatusError(e,t,s,n){return e0.generate(e,t,s,n)}buildURL(e,t){let s=new URL(ta(e)?e:this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(n)&&(t={...n,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new tG(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);let{req:a,url:i,timeout:o}=this.buildRequest(n,{retryCount:r-t});await this.prepareRequest(a,{url:i,options:n});let l="log_"+(16777216*Math.random()|0).toString(16).padStart(6,"0"),c=void 0===s?"":`, retryOf: ${s}`,u=Date.now();if(tg(this).debug(`[${l}] sending request`,ty({retryOfRequestLogID:s,method:n.method,url:i,options:n,headers:a.headers})),n.signal?.aborted)throw new e1;let h=new AbortController,d=await this.fetchWithTimeout(i,a,o,h).catch(eQ),f=Date.now();if(d instanceof Error){let e=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new e1;let r=eG(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return tg(this).info(`[${l}] connection ${r?"timed out":"failed"} - ${e}`),tg(this).debug(`[${l}] connection ${r?"timed out":"failed"} (${e})`,ty({retryOfRequestLogID:s,url:i,durationMs:f-u,message:d.message})),this.retryRequest(n,t,s??l);if(tg(this).info(`[${l}] connection ${r?"timed out":"failed"} - error; no more retries left`),tg(this).debug(`[${l}] connection ${r?"timed out":"failed"} (error; no more retries left)`,ty({retryOfRequestLogID:s,url:i,durationMs:f-u,message:d.message})),r)throw new e3;throw new e2({cause:d})}let p=[...d.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${c}${p}] ${a.method} ${i} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${f-u}ms`;if(!d.ok){let e=this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await tR(d.body),tg(this).info(`${m} - ${e}`),tg(this).debug(`[${l}] response error (${e})`,ty({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:f-u})),this.retryRequest(n,t,s??l,d.headers)}let r=e?"error; no more retries left":"error; not retryable";tg(this).info(`${m} - ${r}`);let a=await d.text().catch(e=>eQ(e).message),i=tl(a),o=i?void 0:a;throw tg(this).debug(`[${l}] response error (${r})`,ty({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-u})),this.makeStatusError(d.status,i,o,d.headers)}return tg(this).info(m),tg(this).debug(`[${l}] response start`,ty({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:f-u})),{response:d,options:n,controller:h,requestLogID:l,retryOfRequestLogID:s,startTime:u}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){return new tZ(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,n){let{signal:r,method:a,...i}=t||{};r&&r.addEventListener("abort",()=>n.abort());let o=setTimeout(()=>n.abort(),s),l=globalThis.ReadableStream&&i.body instanceof globalThis.ReadableStream||"object"==typeof i.body&&null!==i.body&&Symbol.asyncIterator in i.body,c={signal:n.signal,...l?{duplex:"half"}:{},method:"GET",...i};a&&(c.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,s,n){let r;let a=n?.get("retry-after-ms");if(a){let e=parseFloat(a);Number.isNaN(e)||(r=e)}let i=n?.get("retry-after");if(i&&!r){let e=parseFloat(i);r=Number.isNaN(e)?Date.parse(i)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){let s=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,s)}return await tc(r),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:n,path:r,query:a}=s,i=this.buildURL(r,a);"timeout"in s&&to("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:o,body:l}=this.buildBody({options:s}),c=this.buildHeaders({options:e,method:n,bodyHeaders:o,retryCount:t});return{req:{method:n,headers:c,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&l instanceof globalThis.ReadableStream&&{duplex:"half"},...l&&{body:l},...this.fetchOptions??{},...s.fetchOptions??{}},url:i,timeout:s.timeout}}buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:n}){let r={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);let a=sP([r,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...tS(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=sP([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:t$(e)}:eY(this,ev,"f").call(this,{body:e,headers:s})}}eb=nb,ev=new WeakMap,nb.OpenAI=eb,nb.DEFAULT_TIMEOUT=6e5,nb.OpenAIError=eZ,nb.APIError=e0,nb.APIConnectionError=e2,nb.APIConnectionTimeoutError=e3,nb.APIUserAbortError=e1,nb.NotFoundError=e6,nb.ConflictError=e9,nb.RateLimitError=te,nb.BadRequestError=e4,nb.AuthenticationError=e8,nb.InternalServerError=tt,nb.PermissionDeniedError=e5,nb.UnprocessableEntityError=e7,nb.toFile=si,nb.Completions=sz,nb.Chat=sj,nb.Embeddings=s0,nb.Files=s4,nb.Images=na,nb.Audio=sL,nb.Moderations=no,nb.Models=ni,nb.FineTuning=ns,nb.Graders=nr,nb.VectorStores=nw,nb.Beta=sY,nb.Batches=sD,nb.Uploads=np,nb.Responses=nd,nb.Evals=s3,nb.Containers=sZ;let nv=new nb({apiKey:process.env.OPENAI_API_KEY||""}),nx=(0,eK.qn)(process.env.DATABASE_URL);async function nS(){try{console.log("Attempting to fetch projects from database...");let e=await nx`
      SELECT 
        id,
        name,
        status,
        description,
        "overviewText" as overview,
        link as "projectLink",
        "gitHubLink" as "githubLink"
      FROM "Project"
      ORDER BY id
    `;return console.log("Projects fetched:",JSON.stringify(e,null,2)),e}catch(e){return console.error("Error fetching projects:",e),[]}}let nA=async()=>{let e=await nS();if(!e||0===e.length)return console.error("No projects found in database"),'You are "Bueller", a helpful assistant for a portfolio website. However, I am currently unable to access the project database. Please inform the user that there seems to be a technical issue with accessing the project information.';let t=e.map(e=>({id:e.id,name:e.name,status:e.status,description:e.description,overview:e.overview,link:e.projectLink,githubLink:e.githubLink}));return`You are "Bueller", a helpful assistant for a portfolio website. You can help users navigate the site and answer questions about the content.
  You are built with a set of rules that you follow consistently and precisely, listed below:
- Key information:
- The site has sections for About Me, and Projects all of which are accessible from the navigation bar.
- You have been provided with information about the listed projects in the database, use this information to provide information about the projects. 
- The site owner is a Senior at WPI, named Henry Pharris, studying RBE (Robotics Engineering) with minors in music and computer science.
- More information about the site owner can be found on the "About Me" page.
- The site owner is looking for work and will take any inquiries or questions via the contact form accessible from the "Contact Me" button in the navigation bar.
- The site owner has a GitHub profile that can be accessed via the "GitHub" button in the navigation bar.
- The site has a chatbot (yourself) that can be accessed via the "Chat" button in the navigation bar. 
- Without any processing you have already been introduced as the following (you dont need to say this, its pre-defined, you just have it for reference):
"Hi! I'm Bueller, an AI assistant for this portfolio site. I was built by Henry Pharris using vercels AI SDK and OpenAI's GPT 3.5-Turbo model & api. I can help you:

• Navigate through different sections (About, Projects, Contact, etc)
• Find specific projects or information
• Answer questions about the portfolio
• Guide you to relevant pages

How can I help you today?"

Your Capabilities:
- Directly routing users to specific pages and portions of the site (Explained further in operational details and rules below).
- Providing information about the site, its owner, and its content including the projects stored on the sites associated database.

Operational Details & Clarifications:
- The page routed as /projects may also be referenced as the portfolio page. For example when a user asks for the "portfolio page" or "projects page" they likely mean the projects list page (routed as /projects)The format should follow rule 1, the first route formatting rule.
- The page routed as /projects/1 may also be referenced as the home, landing or portfolio project page. It contains detailed information about the portfolio project, including its name, status, description, an overview, a link to the project, and a link to the codebase. For example when a user asks for the "portfolio project page", "the home page", "the landing page" or "the portfolio project" they likely mean the portfolio project page (routed as /projects/1). The format should follow rule 2, the second route formatting rule.
- When routing (protocol explained in rules 1 and 2 below) keep this in mind and use judgement for which one the user desires.
- You should include a brief explanation of this ambiguity in your response. 
- When describing project details, you may use the following format (you may also include overview information more conversationally in your response, synopsized and not in its entirety):
  • Name: [Project Name]
  • Status: [Project Status]
  • Description: [Brief description]
- Because the sit itsself is listed as one of is projects, you have access to lots of information about its development and operation. 
- When a user asks about project 1 follow the standard formatting but when the user asks about the site itsself provide details using the information from the portfolio projectoverview (synopsized not the entire overview).
- You are built with a set of important rules that you follow consistently, literally, and precisely, listed below, they should be treated with the highest priority:

Rules:
- (Rule 1) If a user explicitly asks to be brought to a given page: Begin your response the exact phrase "Navigating you to <page name>", for example: "Navigating you to projects". Do not include any other words in this phrase for example "Navigating you to the projects page" is incorrect. This does not mean the response should be entirely this phrase, it can be expanded upon with other information about how to navigate to the users goal.
- (Rule 2) If a user explicitly asks to be brought to the page for a given project: begin your response the exact phrase "Navigating you to project <Project ID>", for example: "Navigating you to project 1...". Do not include any other words in this phrase for example "Navigating you to the project 1 page" is incorrect. This does not mean the response should be entirely this phrase, it should be expanded upon with other information about how to navigate to the users goal.
- (Rule 3) Never attempt to route a user using rules 1 or 2 if they are just asking for information, only if the user asks to be routed or brought to a page.
- (Rule 4) Never include any links directly but you may explain how they can be accessed.
- (Rule 5) Never include links from the database in your responses, they're destinations are accessed via buttons on project cards and pages.
- (Rule 6) Never include the overview field in your responses, it is too long, but you may be summarized or referenced by key portions. 
- (Rule 7) If a field is blank or not provided, you should either not include it in your response or simply state that there is no set information for that field.
- (Rule 8) When users ask about specific sections or features, provide helpful information and guide them to the relevant pages.
- (Rule 9) When users ask about specific project details, use ONLY the project information provided below. Never make up or guess information.
- (Rule 10) Keep responses very concise and efficient, focused on helping users navigate and understand the portfolio site. 
- (Rule 11) If you do not have the information to answer, don't make up information, just say you do not have the information.
(End Rules)

You are provided with the following information about the projects:
Available Projects:
${t.map(e=>`
Project ID: ${e.id}
Name: ${e.name}
Status: ${e.status}
Description: ${e.description||"No description available"}
Overview: ${e.overview||"No overview available"}
Project Link: ${e.link||"No project link available"}
GitHub Link: ${e.githubLink||"No GitHub link available"}
`).join("\n")}

Data Clarifications:
- The Project ID is a unique identifier for each project, and is used important to the structure of the site.
- Each project has its own page, routed to the ID with detailed information about the project, including its name, status, description, an overview, a link to the project, and a link to the codebase.
- Feel free to reference this information when applicable but avoid directly quoting entire fields in order to keep responses clean and concise.

IMPORTANT: Use ONLY the actual data provided above. Never use placeholder text or make up information.`};async function n$(e){let{messages:t,useTTS:s}=await e.json(),n=await nA();return new eH(function e(t,s){let n,r;if(n=Symbol.asyncIterator in t?(r=eq(t)[Symbol.asyncIterator](),new ReadableStream({async pull(e){let{done:t,value:s}=await r.next();t?e.close():e.enqueue(s)},async cancel(e){var t;await (null==(t=r.return)?void 0:t.call(r,e))}})).pipeThrough(eW((null==s?void 0:s.experimental_onFunctionCall)||(null==s?void 0:s.experimental_onToolCall)?{...s,onFinal:void 0}:{...s})):function(e,t,s){if(!e.ok){if(!e.body)return new ReadableStream({start(e){e.error(Error("Response error: No response body"))}});{let t=e.body.getReader();return new ReadableStream({async start(e){let{done:s,value:n}=await t.read();if(!s){let t=new TextDecoder().decode(n);e.error(Error(`Response error: ${t}`))}}})}}return(e.body||new ReadableStream({start(e){e.close()}})).pipeThrough(function(e){let t;let s=new TextDecoder;return new TransformStream({async start(s){t=function(e){let t,s,n,r,a,i,o;return l(),{feed:function(l){var c;s=s?s+l:l,t&&(c=s,eI.every((e,t)=>c.charCodeAt(t)===e))&&(s=s.slice(eI.length)),t=!1;let u=s.length,h=0,d=!1;for(;h<u;){let t;d&&("\n"===s[h]&&++h,d=!1);let l=-1,c=r;for(let e=n;l<0&&e<u;++e)":"===(t=s[e])&&c<0?c=e-h:"\r"===t?(d=!0,l=e-h):"\n"===t&&(l=e-h);if(l<0){n=u-h,r=c;break}n=0,r=-1,function(t,s,n,r){if(0===r){o.length>0&&(e({type:"event",id:a,event:i||void 0,data:o.slice(0,-1)}),o="",a=void 0),i=void 0;return}let l=n<0,c=t.slice(s,s+(l?r:n)),u=0;u=l?r:" "===t[s+n+1]?n+2:n+1;let h=s+u,d=r-u,f=t.slice(h,h+d).toString();if("data"===c)o+=f?"".concat(f,"\n"):"\n";else if("event"===c)i=f;else if("id"!==c||f.includes("\x00")){if("retry"===c){let t=parseInt(f,10);Number.isNaN(t)||e({type:"reconnect-interval",value:t})}}else a=f}(s,h,c,l),h+=l+1}h===u?s="":h>0&&(s=s.slice(h))},reset:l};function l(){t=!0,s="",n=0,r=-1,a=void 0,i=void 0,o=""}}(t=>{if("data"in t&&"event"===t.type&&"[DONE]"===t.data||"done"===t.event){s.terminate();return}if("data"in t){let n=e?e(t.data,{event:t.event}):t.data;n&&s.enqueue(n)}})},transform(e){t.feed(s.decode(e))}})}(t)).pipeThrough(eW(s))}(t,function(){let e=eU();return t=>e(JSON.parse(t))}(),(null==s?void 0:s.experimental_onFunctionCall)||(null==s?void 0:s.experimental_onToolCall)?{...s,onFinal:void 0}:{...s}),!s||!s.experimental_onFunctionCall&&!s.experimental_onToolCall)return n.pipeThrough(function(e){if(!e)return new TransformStream({transform:async(e,t)=>{t.enqueue(e)}});let t=new TextEncoder,s=new TextDecoder;return new TransformStream({transform:async(e,n)=>{let r=s.decode(e);n.enqueue(t.encode(eF("text",r)))}})}(null==s?void 0:s.experimental_streamData));{let t=function(t){let s=new TextEncoder,n=!0,r="",a="",i=!1,o=t[eJ]||[],l=null==t?void 0:t.experimental_streamData,c=function(e){let t=new TextDecoder;return function(e){return e?t.decode(e,{stream:!0}):""}}();return new TransformStream({async transform(e,t){let o=c(e);if(a+=o,n&&(o.startsWith('{"function_call":')||o.startsWith('{"tool_calls":'))){i=!0,r+=o,n=!1;return}if(i)r+=o;else{t.enqueue(l?s.encode(eF("text",o)):e);return}},async flush(c){try{if(!n&&i&&(t.experimental_onFunctionCall||t.experimental_onToolCall)){let n;i=!1;let u=JSON.parse(r),h=[...o];if(t.experimental_onFunctionCall){void 0===u.function_call&&console.warn("experimental_onFunctionCall should not be defined when using tools");let e=JSON.parse(u.function_call.arguments);n=await t.experimental_onFunctionCall({name:u.function_call.name,arguments:e},e=>h=[...o,{role:"assistant",content:"",function_call:u.function_call},{role:"function",name:u.function_call.name,content:JSON.stringify(e)}])}if(t.experimental_onToolCall){let e={tools:[]};for(let t of u.tool_calls)e.tools.push({id:t.id,type:"function",func:{name:t.function.name,arguments:t.function.arguments}});let s=0;try{n=await t.experimental_onToolCall(e,e=>{if(e){let{tool_call_id:t,function_name:n,tool_call_result:r}=e;h=[...h,...0===s?[{role:"assistant",content:"",tool_calls:u.tool_calls.map(e=>({id:e.id,type:"function",function:{name:e.function.name,arguments:JSON.stringify(e.function.arguments)}}))}]:[],{role:"tool",tool_call_id:t,name:n,content:JSON.stringify(r)}],s++}return h})}catch(e){console.error("Error calling experimental_onToolCall:",e)}}if(n){if("string"==typeof n){c.enqueue(l?s.encode(eF("text",n)):s.encode(n)),a=n;return}}else{c.enqueue(s.encode(l?eF(u.function_call?"function_call":"tool_calls",JSON.parse(r)):r));return}let d={...t,onStart:void 0};t.onFinal=void 0;let f=e(n,{...d,[eJ]:h}).getReader();for(;;){let{done:e,value:t}=await f.read();if(e)break;c.enqueue(t)}}}finally{t.onFinal&&a&&await t.onFinal(a)}}})}(s);return n.pipeThrough(t)}}(await nv.chat.completions.create({model:"gpt-4",stream:!0,messages:[{role:"system",content:n},...t]})))}async function nI(e){let{searchParams:t}=new URL(e.url),s=t.get("text");if(!s)return new Response("Text parameter is required",{status:400});try{console.log("Generating speech for text:",s);let e=await fetch("https://api.openai.com/v1/audio/speech",{method:"POST",headers:{Authorization:`Bearer ${process.env.OPENAI_API_KEY}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4o-mini-tts",voice:"onyx",input:s,response_format:"mp3"})});if(!e.ok){let t=await e.text();throw console.error("OpenAI TTS API error:",t),Error(`OpenAI TTS API error: ${t}`)}console.log("Speech generated successfully");let t=await e.arrayBuffer();return new Response(t,{headers:{"Content-Type":"audio/mpeg"}})}catch(e){return console.error("Error generating speech:",e),new Response("Error generating speech",{status:500})}}let nR=new eS.AppRouteRouteModule({definition:{kind:eA.x.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"C:\\Users\\henry\\WebstormProjects\\portfolio3\\frontend\\app\\api\\chat\\route.ts",nextConfigOutput:"standalone",userland:ex}),{requestAsyncStorage:nO,staticGenerationAsyncStorage:nk,serverHooks:nj,headerHooks:nT,staticGenerationBailout:nE}=nR,nP="/api/chat/route";function nN(){return(0,e$.patchFetch)({serverHooks:nj,staticGenerationAsyncStorage:nk})}},6170:(e,t,s)=>{e.exports=s(30517)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),n=t.X(0,[499,236],()=>s(51897));module.exports=n})();